<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‘æœµé£˜åŠ¨æ•ˆæœæµ‹è¯• - å¤§åœ£è·‘é…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', 'Arial', sans-serif;
            background-color: #000;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        
        canvas {
            display: block;
            background-color: #0f3460;
            border: 2px solid #ffd700;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            max-width: 300px;
        }
        
        .controls h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            font-size: 14px;
            min-width: 200px;
        }
        
        .info h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .info-item {
            margin-bottom: 5px;
        }
        
        .btn {
            padding: 8px 16px;
            font-size: 14px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 5px 0;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .cloud-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            min-width: 250px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .cloud-info h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .cloud-item {
            margin-bottom: 8px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 12px;
        }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 10px;
        }
        
        .preset-btn {
            padding: 6px 8px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="canvas" width="800" height="600"></canvas>
    </div>
    
    <div class="controls">
        <h3>â˜ï¸ äº‘æœµæ§åˆ¶</h3>
        
        <div class="control-group">
            <label for="cloudCount">äº‘æœµæ•°é‡: <span id="cloudCountValue">8</span></label>
            <input type="range" id="cloudCount" min="1" max="20" step="1" value="8">
        </div>
        
        <div class="control-group">
            <label for="waveAmplitude">æ³¢æµªå¹…åº¦: <span id="waveAmplitudeValue">15</span></label>
            <input type="range" id="waveAmplitude" min="0" max="50" step="1" value="15">
        </div>
        
        <div class="control-group">
            <label for="waveFrequency">æ³¢æµªé¢‘ç‡: <span id="waveFrequencyValue">0.8</span></label>
            <input type="range" id="waveFrequency" min="0.1" max="2" step="0.1" value="0.8">
        </div>
        
        <div class="control-group">
            <label for="shapeVariation">å½¢çŠ¶å˜åŒ–: <span id="shapeVariationValue">0.2</span></label>
            <input type="range" id="shapeVariation" min="0" max="0.5" step="0.05" value="0.2">
        </div>
        
        <div class="control-group">
            <label for="cloudSpeed">äº‘æœµé€Ÿåº¦: <span id="cloudSpeedValue">1</span></label>
            <input type="range" id="cloudSpeed" min="0.1" max="3" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <label for="timeSpeed">æ—¶é—´æµé€Ÿ: <span id="timeSpeedValue">1</span></label>
            <input type="range" id="timeSpeed" min="0.1" max="3" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <label>
                <input type="checkbox" id="showClouds" checked> æ˜¾ç¤ºäº‘æœµ
            </label>
        </div>
        
        <div class="control-group">
            <label>
                <input type="checkbox" id="showTrails" checked> æ˜¾ç¤ºè½¨è¿¹
            </label>
        </div>
        
        <button id="resetBtn" class="btn">é‡ç½®äº‘æœµ</button>
        
        <div class="control-group">
            <h4 style="margin-bottom: 5px;">é¢„è®¾æ•ˆæœ:</h4>
            <div class="preset-buttons">
                <button class="preset-btn" data-preset="gentle">å¾®é£</button>
                <button class="preset-btn" data-preset="stormy">é£æš´</button>
                <button class="preset-btn" data-preset="playful">æ´»æ³¼</button>
                <button class="preset-btn" data-preset="majestic">å£®è§‚</button>
                <button class="preset-btn" data-preset="calm">å¹³é™</button>
                <button class="preset-btn" data-preset="dynamic">åŠ¨æ„Ÿ</button>
            </div>
        </div>
    </div>
    
    <div class="info">
        <h3>ğŸŒ¤ï¸ èƒŒæ™¯ä¿¡æ¯</h3>
        <div class="info-item">æ¸¸æˆæ—¶é—´: <span id="gameTime">0.0</span>s</div>
        <div class="info-item">FPS: <span id="fps">60</span></div>
        <div class="info-item">æ´»è·ƒäº‘æœµ: <span id="activeClouds">8</span></div>
        <div class="info-item">å¹³å‡é€Ÿåº¦: <span id="avgSpeed">0</span> px/s</div>
        <div class="info-item">æœ€å¤§å¹…åº¦: <span id="maxAmplitude">0</span> px</div>
    </div>
    
    <div class="cloud-info">
        <h3>â˜ï¸ äº‘æœµè¯¦æƒ…</h3>
        <div id="cloudDetails">
            <!-- äº‘æœµè¯¦ç»†ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <script>
        // æ¸¸æˆå¸¸é‡
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 600;
        
        // åŠ¨æ€èƒŒæ™¯é…ç½®
        let CLOUD_COUNT = 8;
        const DAY_CYCLE_DURATION = 20; // 20ç§’ä¸€ä¸ªå®Œæ•´çš„æ˜¼å¤œå¾ªç¯
        
        // æ§åˆ¶å‚æ•°
        let timeSpeedMultiplier = 1;
        let cloudSpeedMultiplier = 1;
        let waveAmplitudeMultiplier = 1;
        let waveFrequencyMultiplier = 1;
        let shapeVariationMultiplier = 1;
        let showClouds = true;
        let showTrails = true;
        
        // é¢„è®¾é…ç½®
        const presets = {
            gentle: {
                cloudCount: 6,
                waveAmplitude: 0.5,
                waveFrequency: 0.5,
                shapeVariation: 0.1,
                cloudSpeed: 0.5
            },
            stormy: {
                cloudCount: 12,
                waveAmplitude: 2.5,
                waveFrequency: 1.5,
                shapeVariation: 0.4,
                cloudSpeed: 2.5
            },
            playful: {
                cloudCount: 10,
                waveAmplitude: 1.8,
                waveFrequency: 1.2,
                shapeVariation: 0.3,
                cloudSpeed: 1.3
            },
            majestic: {
                cloudCount: 8,
                waveAmplitude: 1.2,
                waveFrequency: 0.7,
                shapeVariation: 0.25,
                cloudSpeed: 0.8
            },
            calm: {
                cloudCount: 4,
                waveAmplitude: 0.3,
                waveFrequency: 0.4,
                shapeVariation: 0.1,
                cloudSpeed: 0.4
            },
            dynamic: {
                cloudCount: 15,
                waveAmplitude: 2.0,
                waveFrequency: 1.8,
                shapeVariation: 0.45,
                cloudSpeed: 2.0
            }
        };
        
        // æ¸¸æˆçŠ¶æ€
        let gameTime = 0;
        let lastUpdateTime = 0;
        let isGamePaused = false;
        
        // æ€§èƒ½ç›‘æ§
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let currentFps = 60;
        
        // åŠ¨æ€èƒŒæ™¯å…ƒç´ 
        let clouds = [];
        let cloudTrails = [];
        
        // åˆå§‹åŒ–åŠ¨æ€èƒŒæ™¯
        function initBackground() {
            // æ¸…ç©ºç°æœ‰äº‘æœµ
            clouds = [];
            cloudTrails = [];
            
            // åˆå§‹åŒ–äº‘æœµ - åˆ†å±‚è®¾è®¡
            for (let i = 0; i < CLOUD_COUNT; i++) {
                const layer = Math.floor(i / (CLOUD_COUNT / 3)); // åˆ†ä¸º3å±‚
                const baseSize = 80 + Math.random() * 60;
                
                // åˆ›å»ºäº‘æœµå¯¹è±¡
                const cloud = {
                    id: i,
                    x: Math.random() * GAME_WIDTH,
                    y: Math.random() * (GAME_HEIGHT * 0.7), // äº‘æœµåªå‡ºç°åœ¨ä¸ŠåŠéƒ¨åˆ†
                    baseX: 0, // åŸºç¡€Xä½ç½®ï¼ˆç”¨äºæ³¢æµªè¿åŠ¨ï¼‰
                    baseY: 0, // åŸºç¡€Yä½ç½®ï¼ˆç”¨äºæ³¢æµªè¿åŠ¨ï¼‰
                    width: baseSize,
                    height: baseSize * (0.4 + Math.random() * 0.2), // é«˜åº¦ä¸å®½åº¦æˆæ¯”ä¾‹
                    speed: 20 + Math.random() * 30 + (layer * 15), // ä¸Šå±‚äº‘æœµé€Ÿåº¦æ›´å¿«
                    opacity: 0.3 + Math.random() * 0.4 - (layer * 0.1), // ä¸Šå±‚äº‘æœµæ›´é€æ˜
                    layer: layer, // è®°å½•äº‘å±‚
                    waveAmplitudeX: 10 + Math.random() * 20, // æ°´å¹³æ³¢æµªæŒ¯å¹…
                    waveAmplitudeY: 5 + Math.random() * 10, // å‚ç›´æ³¢æµªæŒ¯å¹…
                    waveFrequencyX: 0.5 + Math.random() * 1, // æ°´å¹³æ³¢æµªé¢‘ç‡
                    waveFrequencyY: 0.3 + Math.random() * 0.7, // å‚ç›´æ³¢æµªé¢‘ç‡
                    wavePhaseX: Math.random() * Math.PI * 2, // æ°´å¹³æ³¢æµªç›¸ä½
                    wavePhaseY: Math.random() * Math.PI * 2, // å‚ç›´æ³¢æµªç›¸ä½
                    shapeVariation: Math.random() * 0.3 + 0.8, // å½¢çŠ¶å˜åŒ–ç³»æ•°
                    shapePhase: Math.random() * Math.PI * 2, // å½¢çŠ¶å˜åŒ–ç›¸ä½
                    shapeSpeed: 0.1 + Math.random() * 0.2, // å½¢çŠ¶å˜åŒ–é€Ÿåº¦
                    colorVariation: Math.random() * 0.1, // é¢œè‰²å˜åŒ–
                    trail: [] // è½¨è¿¹ç‚¹
                };
                
                // åˆå§‹åŒ–åŸºç¡€ä½ç½®
                cloud.baseX = cloud.x;
                cloud.baseY = cloud.y;
                
                clouds.push(cloud);
                
                // åˆå§‹åŒ–è½¨è¿¹
                cloudTrails.push([]);
            }
            
            updateCloudDetails();
        }
        
        // æ›´æ–°åŠ¨æ€èƒŒæ™¯
        function updateBackground(deltaTime) {
            const scaledDeltaTime = deltaTime * timeSpeedMultiplier;
            const gameTimeOfDay = (gameTime % DAY_CYCLE_DURATION) / DAY_CYCLE_DURATION;
            
            // æ›´æ–°äº‘æœµä½ç½® - æ³¢æµªå½¢é£˜åŠ¨æ•ˆæœ
            clouds.forEach((cloud, index) => {
                // æ›´æ–°æ³¢æµªç›¸ä½
                cloud.wavePhaseX += cloud.waveFrequencyX * waveFrequencyMultiplier * scaledDeltaTime;
                cloud.wavePhaseY += cloud.waveFrequencyY * waveFrequencyMultiplier * scaledDeltaTime;
                cloud.shapePhase += cloud.shapeSpeed * scaledDeltaTime;
                
                // è®¡ç®—æ³¢æµªå½¢ä½ç§»
                const waveOffsetX = Math.sin(cloud.wavePhaseX) * cloud.waveAmplitudeX * waveAmplitudeMultiplier;
                const waveOffsetY = Math.sin(cloud.wavePhaseY) * cloud.waveAmplitudeY * waveAmplitudeMultiplier;
                
                // æ›´æ–°åŸºç¡€ä½ç½®ï¼ˆæ°´å¹³ç§»åŠ¨ï¼‰
                cloud.baseX -= cloud.speed * cloudSpeedMultiplier * scaledDeltaTime;
                
                // åº”ç”¨æ³¢æµªæ•ˆæœåˆ°å®é™…ä½ç½®
                cloud.x = cloud.baseX + waveOffsetX;
                cloud.y = cloud.baseY + waveOffsetY;
                
                // è®°å½•è½¨è¿¹ç‚¹ï¼ˆæ¯éš”ä¸€å®šæ—¶é—´ï¼‰
                if (showTrails && frameCount % 10 === 0) {
                    cloudTrails[index].push({
                        x: cloud.x + cloud.width / 2,
                        y: cloud.y + cloud.height / 2,
                        time: gameTime
                    });
                    
                    // é™åˆ¶è½¨è¿¹ç‚¹æ•°é‡
                    if (cloudTrails[index].length > 50) {
                        cloudTrails[index].shift();
                    }
                }
                
                // äº‘æœµç§»å‡ºå±å¹•åä»å³ä¾§é‡æ–°è¿›å…¥
                if (cloud.x + cloud.width < 0) {
                    cloud.baseX = GAME_WIDTH;
                    cloud.baseY = Math.random() * (GAME_HEIGHT * 0.7);
                    cloud.x = cloud.baseX;
                    cloud.y = cloud.baseY;
                    cloud.opacity = 0.3 + Math.random() * 0.4 - (cloud.layer * 0.1);
                    
                    // é‡ç½®æ³¢æµªç›¸ä½ï¼Œé¿å…æ‰€æœ‰äº‘æœµè¿åŠ¨åŒæ­¥
                    cloud.wavePhaseX = Math.random() * Math.PI * 2;
                    cloud.wavePhaseY = Math.random() * Math.PI * 2;
                    
                    // æ¸…ç©ºè½¨è¿¹
                    cloudTrails[index] = [];
                }
            });
            
            // æ›´æ–°äº‘æœµè¯¦ç»†ä¿¡æ¯æ˜¾ç¤º
            if (frameCount % 60 === 0) { // æ¯ç§’æ›´æ–°ä¸€æ¬¡
                updateCloudDetails();
                updateStats();
            }
        }
        
        // ç»˜åˆ¶äº‘æœµå½¢çŠ¶ - åŠ¨æ€å˜åŒ–çš„äº‘æœµè½®å»“
        function drawCloud(ctx, cloud) {
            const x = cloud.x;
            const y = cloud.y;
            const width = cloud.width;
            const height = cloud.height;
            
            // è®¡ç®—å½“å‰å½¢çŠ¶å˜åŒ–ç³»æ•°
            const currentShapeVariation = 1 + Math.sin(cloud.shapePhase) * cloud.shapeVariation * shapeVariationMultiplier;
            
            ctx.beginPath();
            
            // ä½¿ç”¨å¤šä¸ªåœ†å½¢ç»„åˆæˆäº‘æœµå½¢çŠ¶ï¼ŒåŠ å…¥åŠ¨æ€å˜åŒ–
            const centerY = y + height * 0.4; // äº‘æœµä¸­å¿ƒåä¸Š
            const baseRadius = height * 0.4;
            
            // äº‘æœµç»„æˆéƒ¨åˆ†çš„é…ç½®
            const cloudParts = [
                { x: 0.25, y: 0, size: 1.0, phase: 0 },
                { x: 0.5, y: -0.2, size: 0.9, phase: Math.PI/3 },
                { x: 0.75, y: 0, size: 1.0, phase: Math.PI*2/3 },
                { x: 0.4, y: 0.3, size: 0.7, phase: Math.PI },
                { x: 0.65, y: 0.2, size: 0.6, phase: Math.PI*4/3 }
            ];
            
            // ç»˜åˆ¶æ¯ä¸ªäº‘æœµéƒ¨åˆ†ï¼Œåº”ç”¨å½¢çŠ¶å˜åŒ–
            cloudParts.forEach(part => {
                const partPhase = cloud.shapePhase + part.phase;
                const partVariation = 1 + Math.sin(partPhase) * 0.2;
                const partRadius = baseRadius * part.size * currentShapeVariation * partVariation;
                const partX = x + width * part.x;
                const partY = centerY + baseRadius * part.y;
                
                ctx.arc(partX, partY, partRadius, 0, Math.PI * 2);
            });
            
            // äº‘æœµåº•éƒ¨ - ä½¿ç”¨æ›²çº¿è€Œä¸æ˜¯ç›´çº¿
            const bottomY = centerY + baseRadius * 0.3;
            ctx.moveTo(x, bottomY);
            
            // ä½¿ç”¨è´å¡å°”æ›²çº¿åˆ›å»ºæ³¢æµªå½¢åº•éƒ¨
            const curveAmplitude = height * 0.1 * currentShapeVariation;
            ctx.bezierCurveTo(
                x + width * 0.25, bottomY + curveAmplitude,
                x + width * 0.75, bottomY - curveAmplitude,
                x + width, bottomY
            );
            
            ctx.closePath();
            ctx.fill();
            
            // æ·»åŠ äº‘æœµå†…éƒ¨çº¹ç†
            if (Math.random() < 0.5) {
                ctx.globalAlpha *= 0.3;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                
                // ç»˜åˆ¶å†…éƒ¨äº®ç‚¹
                const highlightCount = 2 + Math.floor(Math.random() * 3);
                for (let i = 0; i < highlightCount; i++) {
                    const highlightX = x + Math.random() * width * 0.8 + width * 0.1;
                    const highlightY = y + Math.random() * height * 0.6 + height * 0.2;
                    const highlightSize = baseRadius * 0.2 * (0.5 + Math.random());
                    
                    ctx.beginPath();
                    ctx.arc(highlightX, highlightY, highlightSize, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }
        
        // ç»˜åˆ¶åŠ¨æ€èƒŒæ™¯
        function drawBackground() {
            const gameTimeOfDay = (gameTime % DAY_CYCLE_DURATION) / DAY_CYCLE_DURATION;
            
            // ç»˜åˆ¶æ¸å˜å¤©ç©ºèƒŒæ™¯ - æ ¹æ®æ¸¸æˆæ—¶é—´å˜åŒ–é¢œè‰²
            const gradient = ctx.createLinearGradient(0, 0, 0, GAME_HEIGHT);
            
            // æ ¹æ®æ—¶é—´è°ƒæ•´èƒŒæ™¯é¢œè‰²
            if (gameTimeOfDay < 0.5) {
                // ç™½å¤©æ•ˆæœ - è“è‰²ç³»
                const intensity = 1 - Math.abs(gameTimeOfDay - 0.25) * 4; // ä¸­é—´æœ€äº®
                const blueTop = Math.floor(15 + intensity * 20); // #0f3460 åˆ° #194970
                const blueBottom = Math.floor(22 + intensity * 25); // #16213e åˆ° #1e2e50
                
                gradient.addColorStop(0, `rgb(15, ${blueTop}, 96)`); // æ·±è“è‰²å¤©ç©ºé¡¶éƒ¨
                gradient.addColorStop(1, `rgb(22, 33, ${blueBottom})`); // ç¨æµ…çš„è“è‰²åº•éƒ¨
            } else {
                // é»„æ˜/å¤œæ™šæ•ˆæœ - ç´«è‰²ç³»
                const intensity = Math.abs(gameTimeOfDay - 0.75) * 4; // è¾¹ç¼˜æœ€æš—
                const purpleTop = Math.floor(20 + intensity * 15); // #14142e åˆ° #1e2345
                const purpleBottom = Math.floor(25 + intensity * 20); // #0f1429 åˆ° #161d3a
                
                gradient.addColorStop(0, `rgb(20, 20, ${purpleTop})`); // ç´«è‰²å¤©ç©ºé¡¶éƒ¨
                gradient.addColorStop(1, `rgb(15, 20, ${purpleBottom})`); // æ·±ç´«è‰²åº•éƒ¨
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // ç»˜åˆ¶äº‘æœµè½¨è¿¹
            if (showTrails) {
                cloudTrails.forEach((trail, index) => {
                    if (trail.length > 1) {
                        const cloud = clouds[index];
                        ctx.globalAlpha = cloud.opacity * 0.2;
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        
                        for (let i = 0; i < trail.length; i++) {
                            const point = trail[i];
                            const age = gameTime - point.time;
                            const fadeFactor = Math.max(0, 1 - age / 5); // 5ç§’å†…é€æ¸æ¶ˆå¤±
                            
                            ctx.globalAlpha = cloud.opacity * 0.2 * fadeFactor;
                            
                            if (i === 0) {
                                ctx.moveTo(point.x, point.y);
                            } else {
                                ctx.lineTo(point.x, point.y);
                            }
                        }
                        
                        ctx.stroke();
                    }
                });
            }
            
            // ç»˜åˆ¶äº‘æœµ - ç™½å¤©äº‘æœµæ›´æ˜æ˜¾
            if (showClouds) {
                const cloudOpacity = gameTimeOfDay < 0.5 ? 1 : 0.5; // å¤œæ™šäº‘æœµè¾ƒæš—
                
                // æŒ‰å±‚æ’åºï¼Œç¡®ä¿æ­£ç¡®çš„ç»˜åˆ¶é¡ºåºï¼ˆè¿œçš„å…ˆç”»ï¼‰
                const sortedClouds = [...clouds].sort((a, b) => b.layer - a.layer);
                
                sortedClouds.forEach(cloud => {
                    const finalOpacity = cloud.opacity * cloudOpacity;
                    if (finalOpacity > 0.1) { // é€æ˜åº¦å¤ªä½çš„äº‘æœµä¸æ˜¾ç¤º
                        ctx.save();
                        ctx.globalAlpha = finalOpacity;
                        
                        // æ ¹æ®æ—¶é—´è°ƒæ•´äº‘æœµé¢œè‰²
                        if (gameTimeOfDay < 0.5) {
                            // ç™½å¤©äº‘æœµ - åŠ å…¥å¾®å¦™çš„é¢œè‰²å˜åŒ–
                            const colorVariation = Math.sin(cloud.shapePhase) * cloud.colorVariation;
                            const r = Math.floor(255 * (1 + colorVariation));
                            const g = Math.floor(255 * (1 + colorVariation * 0.8));
                            const b = Math.floor(255 * (1 + colorVariation * 0.6));
                            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, 0.95)`;
                        } else {
                            // å¤œæ™šäº‘æœµ - æ·±è“è‰²è°ƒ
                            ctx.fillStyle = 'rgba(40, 40, 60, 0.8)';
                        }
                        
                        // ç»˜åˆ¶ä¸»äº‘æœµ
                        drawCloud(ctx, cloud);
                        
                        // æ·»åŠ äº‘æœµè¾¹ç¼˜å…‰æ™•æ•ˆæœ
                        if (gameTimeOfDay < 0.5 && Math.random() < 0.3) {
                            ctx.globalAlpha = finalOpacity * 0.2;
                            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                            
                            // åˆ›å»ºç¨å¤§çš„å…‰æ™•äº‘æœµ
                            const glowCloud = {
                                ...cloud,
                                width: cloud.width * 1.1,
                                height: cloud.height * 1.1
                            };
                            drawCloud(ctx, glowCloud);
                        }
                        
                        ctx.restore();
                    }
                });
            }
            
            // é‡ç½®é€æ˜åº¦
            ctx.globalAlpha = 1;
            
            // æ·»åŠ å¤§æ°”è¾‰å…‰æ•ˆæœ
            if (gameTimeOfDay > 0.4 && gameTimeOfDay < 0.6) {
                // é»„æ˜/é»æ˜æ—¶åˆ†çš„è¾‰å…‰
                const glowIntensity = Math.abs(0.5 - gameTimeOfDay) * 20;
                const gradient = ctx.createRadialGradient(
                    GAME_WIDTH / 2, GAME_HEIGHT / 2, 0,
                    GAME_WIDTH / 2, GAME_HEIGHT / 2, GAME_WIDTH
                );
                gradient.addColorStop(0, `rgba(255, 165, 0, ${glowIntensity * 0.01})`);
                gradient.addColorStop(1, 'rgba(255, 165, 0, 0)');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            }
        }
        
        // æ›´æ–°äº‘æœµè¯¦ç»†ä¿¡æ¯æ˜¾ç¤º
        function updateCloudDetails() {
            const cloudDetails = document.getElementById('cloudDetails');
            let html = '';
            
            clouds.forEach((cloud, index) => {
                const waveX = Math.sin(cloud.wavePhaseX) * cloud.waveAmplitudeX * waveAmplitudeMultiplier;
                const waveY = Math.sin(cloud.wavePhaseY) * cloud.waveAmplitudeY * waveAmplitudeMultiplier;
                
                html += `
                    <div class="cloud-item">
                        <strong>äº‘æœµ ${index + 1}</strong><br>
                        ä½ç½®: (${Math.round(cloud.x)}, ${Math.round(cloud.y)})<br>
                        é€Ÿåº¦: ${Math.round(cloud.speed * cloudSpeedMultiplier)} px/s<br>
                        æ³¢æµª: X:${Math.round(waveX)}px, Y:${Math.round(waveY)}px<br>
                        é€æ˜åº¦: ${(cloud.opacity * 100).toFixed(0)}%<br>
                        å±‚çº§: ${cloud.layer + 1}
                    </div>
                `;
            });
            
            cloudDetails.innerHTML = html;
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const activeClouds = clouds.length;
            const avgSpeed = clouds.reduce((sum, cloud) => sum + cloud.speed * cloudSpeedMultiplier, 0) / activeClouds;
            const maxAmplitude = Math.max(...clouds.map(cloud => cloud.waveAmplitudeX * waveAmplitudeMultiplier));
            
            document.getElementById('activeClouds').textContent = activeClouds;
            document.getElementById('avgSpeed').textContent = Math.round(avgSpeed);
            document.getElementById('maxAmplitude').textContent = Math.round(maxAmplitude);
        }
        
        // æ¸²æŸ“æ¸¸æˆ
        function renderGame() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // ç»˜åˆ¶åŠ¨æ€èƒŒæ™¯
            drawBackground();
            
            // ç»˜åˆ¶è°ƒè¯•ä¿¡æ¯
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(10, GAME_HEIGHT - 40, 200, 30);
            
            ctx.fillStyle = 'white';
            ctx.font = '14px Arial';
            ctx.fillText(`äº‘æœµæ•°é‡: ${clouds.length}`, 20, GAME_HEIGHT - 20);
        }
        
        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            const currentTime = performance.now();
            const deltaTime = (currentTime - lastUpdateTime) / 1000; // è½¬æ¢ä¸ºç§’
            lastUpdateTime = currentTime;
            
            // æ›´æ–°FPS
            frameCount++;
            if (currentTime - lastFpsUpdate >= 1000) {
                currentFps = Math.round(frameCount * 1000 / (currentTime - lastFpsUpdate));
                frameCount = 0;
                lastFpsUpdate = currentTime;
                document.getElementById('fps').textContent = currentFps;
            }
            
            if (!isGamePaused) {
                gameTime += deltaTime;
                document.getElementById('gameTime').textContent = gameTime.toFixed(1);
                
                // æ›´æ–°åŠ¨æ€èƒŒæ™¯
                updateBackground(deltaTime);
            }
            
            // æ¸²æŸ“æ¸¸æˆ
            renderGame();
            
            // ç»§ç»­æ¸¸æˆå¾ªç¯
            requestAnimationFrame(gameLoop);
        }
        
        // åº”ç”¨é¢„è®¾é…ç½®
        function applyPreset(presetName) {
            const preset = presets[presetName];
            if (!preset) return;
            
            // æ›´æ–°äº‘æœµæ•°é‡
            CLOUD_COUNT = preset.cloudCount;
            document.getElementById('cloudCount').value = CLOUD_COUNT;
            document.getElementById('cloudCountValue').textContent = CLOUD_COUNT;
            
            // æ›´æ–°æ³¢æµªå¹…åº¦
            waveAmplitudeMultiplier = preset.waveAmplitude;
            document.getElementById('waveAmplitude').value = preset.waveAmplitude * 10;
            document.getElementById('waveAmplitudeValue').textContent = preset.waveAmplitude * 10;
            
            // æ›´æ–°æ³¢æµªé¢‘ç‡
            waveFrequencyMultiplier = preset.waveFrequency;
            document.getElementById('waveFrequency').value = preset.waveFrequency;
            document.getElementById('waveFrequencyValue').textContent = preset.waveFrequency.toFixed(1);
            
            // æ›´æ–°å½¢çŠ¶å˜åŒ–
            shapeVariationMultiplier = preset.shapeVariation;
            document.getElementById('shapeVariation').value = preset.shapeVariation;
            document.getElementById('shapeVariationValue').textContent = preset.shapeVariation.toFixed(2);
            
            // æ›´æ–°äº‘æœµé€Ÿåº¦
            cloudSpeedMultiplier = preset.cloudSpeed;
            document.getElementById('cloudSpeed').value = preset.cloudSpeed;
            document.getElementById('cloudSpeedValue').textContent = preset.cloudSpeed.toFixed(1);
            
            // é‡æ–°åˆå§‹åŒ–äº‘æœµ
            initBackground();
        }
        
        // åˆå§‹åŒ–æ§åˆ¶äº‹ä»¶
        function initControls() {
            // äº‘æœµæ•°é‡æ§åˆ¶
            const cloudCountSlider = document.getElementById('cloudCount');
            const cloudCountValue = document.getElementById('cloudCountValue');
            cloudCountSlider.addEventListener('input', function() {
                CLOUD_COUNT = parseInt(this.value);
                cloudCountValue.textContent = CLOUD_COUNT;
                initBackground();
            });
            
            // æ³¢æµªå¹…åº¦æ§åˆ¶
            const waveAmplitudeSlider = document.getElementById('waveAmplitude');
            const waveAmplitudeValue = document.getElementById('waveAmplitudeValue');
            waveAmplitudeSlider.addEventListener('input', function() {
                waveAmplitudeMultiplier = parseInt(this.value) / 10;
                waveAmplitudeValue.textContent = this.value;
            });
            
            // æ³¢æµªé¢‘ç‡æ§åˆ¶
            const waveFrequencySlider = document.getElementById('waveFrequency');
            const waveFrequencyValue = document.getElementById('waveFrequencyValue');
            waveFrequencySlider.addEventListener('input', function() {
                waveFrequencyMultiplier = parseFloat(this.value);
                waveFrequencyValue.textContent = waveFrequencyMultiplier.toFixed(1);
            });
            
            // å½¢çŠ¶å˜åŒ–æ§åˆ¶
            const shapeVariationSlider = document.getElementById('shapeVariation');
            const shapeVariationValue = document.getElementById('shapeVariationValue');
            shapeVariationSlider.addEventListener('input', function() {
                shapeVariationMultiplier = parseFloat(this.value);
                shapeVariationValue.textContent = shapeVariationMultiplier.toFixed(2);
            });
            
            // äº‘æœµé€Ÿåº¦æ§åˆ¶
            const cloudSpeedSlider = document.getElementById('cloudSpeed');
            const cloudSpeedValue = document.getElementById('cloudSpeedValue');
            cloudSpeedSlider.addEventListener('input', function() {
                cloudSpeedMultiplier = parseFloat(this.value);
                cloudSpeedValue.textContent = cloudSpeedMultiplier.toFixed(1);
            });
            
            // æ—¶é—´æµé€Ÿæ§åˆ¶
            const timeSpeedSlider = document.getElementById('timeSpeed');
            const timeSpeedValue = document.getElementById('timeSpeedValue');
            timeSpeedSlider.addEventListener('input', function() {
                timeSpeedMultiplier = parseFloat(this.value);
                timeSpeedValue.textContent = timeSpeedMultiplier.toFixed(1);
            });
            
            // æ˜¾ç¤º/éšè—äº‘æœµ
            const showCloudsCheckbox = document.getElementById('showClouds');
            showCloudsCheckbox.addEventListener('change', function() {
                showClouds = this.checked;
            });
            
            // æ˜¾ç¤º/éšè—è½¨è¿¹
            const showTrailsCheckbox = document.getElementById('showTrails');
            showTrailsCheckbox.addEventListener('change', function() {
                showTrails = this.checked;
                if (!showTrails) {
                    cloudTrails = clouds.map(() => []);
                }
            });
            
            // é‡ç½®äº‘æœµ
            const resetBtn = document.getElementById('resetBtn');
            resetBtn.addEventListener('click', function() {
                initBackground();
            });
            
            // é¢„è®¾æŒ‰é’®
            const presetButtons = document.querySelectorAll('.preset-btn');
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const presetName = this.dataset.preset;
                    applyPreset(presetName);
                    
                    // é«˜äº®é€‰ä¸­çš„é¢„è®¾
                    presetButtons.forEach(btn => btn.style.background = 'rgba(255, 255, 255, 0.1)');
                    this.style.background = 'rgba(255, 215, 0, 0.3)';
                });
            });
            
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space') {
                    event.preventDefault();
                    isGamePaused = !isGamePaused;
                } else if (event.code === 'KeyR') {
                    initBackground();
                }
            });
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function init() {
            // åˆå§‹åŒ–åŠ¨æ€èƒŒæ™¯
            initBackground();
            
            // åˆå§‹åŒ–æ§åˆ¶
            initControls();
            
            // è®¾ç½®æ¸¸æˆå¾ªç¯
            lastUpdateTime = performance.now();
            lastFpsUpdate = lastUpdateTime;
            gameLoop();
        }
        
        // å¯åŠ¨æ¸¸æˆ
        init();
    </script>
</body>
</html>