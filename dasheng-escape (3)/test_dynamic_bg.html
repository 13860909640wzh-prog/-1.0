<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态背景测试 - 大圣跑酷</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', 'Arial', sans-serif;
            background-color: #000;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        
        canvas {
            display: block;
            background-color: #0f3460;
            border: 2px solid #ffd700;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
        }
        
        .controls h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .control-group {
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            font-size: 14px;
        }
        
        .info h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .info-item {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="canvas" width="800" height="600"></canvas>
    </div>
    
    <div class="controls">
        <h3>背景控制</h3>
        <div class="control-group">
            <label for="cloudSpeed">云朵速度: <span id="cloudSpeedValue">1</span></label>
            <input type="range" id="cloudSpeed" min="0.1" max="3" step="0.1" value="1">
        </div>
        <div class="control-group">
            <label for="mountainSpeed">远山速度: <span id="mountainSpeedValue">1</span></label>
            <input type="range" id="mountainSpeed" min="0.1" max="3" step="0.1" value="1">
        </div>
        <div class="control-group">
            <label for="starTwinkle">星星闪烁: <span id="starTwinkleValue">1</span></label>
            <input type="range" id="starTwinkle" min="0" max="3" step="0.1" value="1">
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="showClouds" checked> 显示云朵
            </label>
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="showMountains" checked> 显示远山
            </label>
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="showStars" checked> 显示星星
            </label>
        </div>
        <div class="control-group">
            <button id="resetBtn" style="width: 100%; padding: 8px; margin-top: 10px; background: #ffd700; border: none; border-radius: 5px; cursor: pointer;">重置背景</button>
        </div>
    </div>
    
    <div class="info">
        <h3>背景元素信息</h3>
        <div class="info-item">云朵数量: <span id="cloudCount">8</span></div>
        <div class="info-item">星星数量: <span id="starCount">50</span></div>
        <div class="info-item">远山数量: <span id="mountainCount">3</span></div>
        <div class="info-item">游戏时间: <span id="gameTime">0.0</span>秒</div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 600;
        
        // 动态背景配置
        let CLOUD_COUNT = 8;
        let STAR_COUNT = 50;
        let MOUNTAIN_COUNT = 3;
        
        // 控制参数
        let cloudSpeedMultiplier = 1;
        let mountainSpeedMultiplier = 1;
        let starTwinkleMultiplier = 1;
        let showClouds = true;
        let showMountains = true;
        let showStars = true;
        
        // 动态背景元素
        let clouds = [];
        let stars = [];
        let mountains = [];
        
        // 游戏状态
        let gameTime = 0;
        let lastUpdateTime = 0;
        
        // 初始化动态背景
        function initBackground() {
            // 初始化云朵
            clouds = [];
            for (let i = 0; i < CLOUD_COUNT; i++) {
                clouds.push({
                    x: Math.random() * GAME_WIDTH,
                    y: Math.random() * (GAME_HEIGHT * 0.7), // 云朵只出现在上半部分
                    width: 80 + Math.random() * 60,
                    height: 40 + Math.random() * 20,
                    speed: 20 + Math.random() * 30, // 不同云朵速度不同
                    opacity: 0.3 + Math.random() * 0.4 // 半透明效果
                });
            }
            
            // 初始化星星
            stars = [];
            for (let i = 0; i < STAR_COUNT; i++) {
                stars.push({
                    x: Math.random() * GAME_WIDTH,
                    y: Math.random() * GAME_HEIGHT,
                    size: 1 + Math.random() * 2,
                    opacity: 0.5 + Math.random() * 0.5,
                    twinkleSpeed: 0.01 + Math.random() * 0.02,
                    twinklePhase: Math.random() * Math.PI * 2
                });
            }
            
            // 初始化远山
            mountains = [];
            for (let i = 0; i < MOUNTAIN_COUNT; i++) {
                mountains.push({
                    x: (i * GAME_WIDTH / MOUNTAIN_COUNT) + Math.random() * 100,
                    y: GAME_HEIGHT * 0.6 + Math.random() * GAME_HEIGHT * 0.2,
                    width: 300 + Math.random() * 200,
                    height: 150 + Math.random() * 100,
                    speed: 10 + Math.random() * 15,
                    opacity: 0.15 + Math.random() * 0.1
                });
            }
            
            // 更新信息显示
            document.getElementById('cloudCount').textContent = CLOUD_COUNT;
            document.getElementById('starCount').textContent = STAR_COUNT;
            document.getElementById('mountainCount').textContent = MOUNTAIN_COUNT;
        }
        
        // 更新动态背景
        function updateBackground(deltaTime) {
            // 更新云朵位置
            clouds.forEach(cloud => {
                cloud.x -= cloud.speed * deltaTime * cloudSpeedMultiplier;
                // 云朵移出屏幕后从右侧重新进入
                if (cloud.x + cloud.width < 0) {
                    cloud.x = GAME_WIDTH;
                    cloud.y = Math.random() * (GAME_HEIGHT * 0.7);
                    cloud.opacity = 0.3 + Math.random() * 0.4;
                }
            });
            
            // 更新星星闪烁
            stars.forEach(star => {
                star.twinklePhase += star.twinkleSpeed * starTwinkleMultiplier;
                star.opacity = 0.5 + 0.5 * Math.sin(star.twinklePhase);
            });
            
            // 更新远山位置
            mountains.forEach(mountain => {
                mountain.x -= mountain.speed * deltaTime * mountainSpeedMultiplier;
                // 远山移出屏幕后从右侧重新进入
                if (mountain.x + mountain.width < 0) {
                    mountain.x = GAME_WIDTH;
                    mountain.y = GAME_HEIGHT * 0.6 + Math.random() * GAME_HEIGHT * 0.2;
                }
            });
        }
        
        // 绘制动态背景
        function drawBackground() {
            // 绘制渐变天空背景
            const gradient = ctx.createLinearGradient(0, 0, 0, GAME_HEIGHT);
            gradient.addColorStop(0, '#0f3460'); // 深蓝色天空顶部
            gradient.addColorStop(1, '#16213e'); // 稍浅的蓝色底部
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // 绘制远山
            if (showMountains) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                mountains.forEach(mountain => {
                    ctx.globalAlpha = mountain.opacity;
                    ctx.beginPath();
                    ctx.moveTo(mountain.x, mountain.y);
                    ctx.lineTo(mountain.x + mountain.width / 4, mountain.y - mountain.height * 0.7);
                    ctx.lineTo(mountain.x + mountain.width / 2, mountain.y - mountain.height);
                    ctx.lineTo(mountain.x + mountain.width * 3 / 4, mountain.y - mountain.height * 0.5);
                    ctx.lineTo(mountain.x + mountain.width, mountain.y);
                    ctx.closePath();
                    ctx.fill();
                });
            }
            
            // 绘制星星
            if (showStars) {
                ctx.fillStyle = 'white';
                stars.forEach(star => {
                    ctx.globalAlpha = star.opacity;
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    ctx.fill();
                });
            }
            
            // 绘制云朵
            if (showClouds) {
                ctx.fillStyle = 'white';
                clouds.forEach(cloud => {
                    ctx.globalAlpha = cloud.opacity;
                    drawCloud(cloud.x, cloud.y, cloud.width, cloud.height);
                });
            }
            
            // 重置透明度
            ctx.globalAlpha = 1;
        }
        
        // 绘制云朵形状
        function drawCloud(x, y, width, height) {
            const radius = height / 2;
            ctx.beginPath();
            ctx.arc(x + radius, y + radius, radius, 0, Math.PI * 2);
            ctx.arc(x + radius * 2, y + radius, radius * 0.8, 0, Math.PI * 2);
            ctx.arc(x + radius * 3, y + radius, radius * 0.9, 0, Math.PI * 2);
            ctx.arc(x + radius * 4, y + radius, radius * 0.7, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // 游戏循环
        function gameLoop() {
            const currentTime = performance.now();
            const deltaTime = (currentTime - lastUpdateTime) / 1000; // 转换为秒
            lastUpdateTime = currentTime;
            
            // 更新游戏时间
            gameTime += deltaTime;
            document.getElementById('gameTime').textContent = gameTime.toFixed(1);
            
            // 更新动态背景
            updateBackground(deltaTime);
            
            // 渲染游戏
            renderGame();
            
            // 继续游戏循环
            requestAnimationFrame(gameLoop);
        }
        
        // 渲染游戏
        function renderGame() {
            // 清空画布
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // 绘制动态背景
            drawBackground();
        }
        
        // 初始化控制事件
        function initControls() {
            // 云朵速度控制
            const cloudSpeedSlider = document.getElementById('cloudSpeed');
            const cloudSpeedValue = document.getElementById('cloudSpeedValue');
            cloudSpeedSlider.addEventListener('input', function() {
                cloudSpeedMultiplier = parseFloat(this.value);
                cloudSpeedValue.textContent = cloudSpeedMultiplier.toFixed(1);
            });
            
            // 远山速度控制
            const mountainSpeedSlider = document.getElementById('mountainSpeed');
            const mountainSpeedValue = document.getElementById('mountainSpeedValue');
            mountainSpeedSlider.addEventListener('input', function() {
                mountainSpeedMultiplier = parseFloat(this.value);
                mountainSpeedValue.textContent = mountainSpeedMultiplier.toFixed(1);
            });
            
            // 星星闪烁控制
            const starTwinkleSlider = document.getElementById('starTwinkle');
            const starTwinkleValue = document.getElementById('starTwinkleValue');
            starTwinkleSlider.addEventListener('input', function() {
                starTwinkleMultiplier = parseFloat(this.value);
                starTwinkleValue.textContent = starTwinkleMultiplier.toFixed(1);
            });
            
            // 显示/隐藏云朵
            const showCloudsCheckbox = document.getElementById('showClouds');
            showCloudsCheckbox.addEventListener('change', function() {
                showClouds = this.checked;
            });
            
            // 显示/隐藏远山
            const showMountainsCheckbox = document.getElementById('showMountains');
            showMountainsCheckbox.addEventListener('change', function() {
                showMountains = this.checked;
            });
            
            // 显示/隐藏星星
            const showStarsCheckbox = document.getElementById('showStars');
            showStarsCheckbox.addEventListener('change', function() {
                showStars = this.checked;
            });
            
            // 重置背景
            const resetBtn = document.getElementById('resetBtn');
            resetBtn.addEventListener('click', function() {
                initBackground();
            });
        }
        
        // 初始化游戏
        function init() {
            initBackground();
            initControls();
            lastUpdateTime = performance.now();
            gameLoop();
        }
        
        // 启动游戏
        init();
    </script>
</body>
</html>