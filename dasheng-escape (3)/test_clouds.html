<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‘æœµé£˜åŠ¨æ•ˆæœæµ‹è¯• - å¤§åœ£è·‘é…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', 'Arial', sans-serif;
            background-color: #000;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        
        canvas {
            display: block;
            background-color: #0f3460;
            border: 2px solid #ffd700;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            max-width: 300px;
        }
        
        .controls h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .control-group {
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            font-size: 14px;
            min-width: 200px;
        }
        
        .info h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .info-item {
            margin-bottom: 5px;
        }
        
        .btn {
            padding: 8px 16px;
            font-size: 14px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 5px 0;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .cloud-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            min-width: 250px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .cloud-info h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .cloud-item {
            margin-bottom: 8px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="canvas" width="800" height="600"></canvas>
    </div>
    
    <div class="controls">
        <h3>â˜ï¸ äº‘æœµæ§åˆ¶</h3>
        <div class="control-group">
            <label for="cloudCount">äº‘æœµæ•°é‡: <span id="cloudCountValue">8</span></label>
            <input type="range" id="cloudCount" min="1" max="20" step="1" value="8">
        </div>
        <div class="control-group">
            <label for="floatSpeed">æµ®åŠ¨é€Ÿåº¦: <span id="floatSpeedValue">1</span></label>
            <input type="range" id="floatSpeed" min="0.1" max="5" step="0.1" value="1">
        </div>
        <div class="control-group">
            <label for="floatAmplitude">æµ®åŠ¨å¹…åº¦: <span id="floatAmplitudeValue">5</span></label>
            <input type="range" id="floatAmplitude" min="0" max="20" step="1" value="5">
        </div>
        <div class="control-group">
            <label for="morphSpeed">å˜å½¢é€Ÿåº¦: <span id="morphSpeedValue">0.25</span></label>
            <input type="range" id="morphSpeed" min="0" max="2" step="0.05" value="0.25">
        </div>
        <div class="control-group">
            <label for="morphAmplitude">å˜å½¢å¹…åº¦: <span id="morphAmplitudeValue">0.1</span></label>
            <input type="range" id="morphAmplitude" min="0" max="0.5" step="0.01" value="0.1">
        </div>
        <div class="control-group">
            <label for="cloudSpeed">ç§»åŠ¨é€Ÿåº¦: <span id="cloudSpeedValue">1</span></label>
            <input type="range" id="cloudSpeed" min="0" max="3" step="0.1" value="1">
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="showTextures" checked> æ˜¾ç¤ºçº¹ç†
            </label>
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="showParticles" checked> æ˜¾ç¤ºç²’å­æ•ˆæœ
            </label>
        </div>
        <div class="control-group">
            <button id="resetBtn" class="btn">é‡ç½®äº‘æœµ</button>
        </div>
        <div class="control-group">
            <button id="exportBtn" class="btn">å¯¼å‡ºé…ç½®</button>
        </div>
    </div>
    
    <div class="info">
        <h3>ğŸŒ¤ï¸ ç¯å¢ƒä¿¡æ¯</h3>
        <div class="info-item">æ¸¸æˆæ—¶é—´: <span id="gameTime">0.0</span>s</div>
        <div class="info-item">FPS: <span id="fps">60</span></div>
        <div class="info-item">äº‘æœµæ€»æ•°: <span id="totalClouds">8</span></div>
        <div class="info-item">æ´»è·ƒäº‘æœµ: <span id="activeClouds">8</span></div>
        <div class="info-item">æ¸²æŸ“æ—¶é—´: <span id="renderTime">0</span>ms</div>
        <div class="info-item">æ›´æ–°æ—¶é—´: <span id="updateTime">0</span>ms</div>
    </div>
    
    <div class="cloud-info">
        <h3>â˜ï¸ äº‘æœµè¯¦æƒ…</h3>
        <div id="cloudDetails">
            <!-- äº‘æœµè¯¦ç»†ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
        </div>
    </div>

    <script>
        // æ¸¸æˆå¸¸é‡
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 600;
        
        // äº‘æœµé…ç½®
        let CLOUD_COUNT = 8;
        let cloudSpeedMultiplier = 1;
        let globalFloatSpeed = 1;
        let globalFloatAmplitude = 5;
        let globalMorphSpeed = 0.25;
        let globalMorphAmplitude = 0.1;
        let showTextures = true;
        let showParticles = true;
        
        // æ¸¸æˆçŠ¶æ€
        let gameTime = 0;
        let lastUpdateTime = 0;
        let isPaused = false;
        
        // æ€§èƒ½ç›‘æ§
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let currentFps = 60;
        let renderTime = 0;
        let updateTime = 0;
        
        // äº‘æœµæ•°ç»„
        let clouds = [];
        let cloudParticles = [];
        
        // ç”Ÿæˆäº‘æœµç»„æˆéƒ¨åˆ†
        function generateCloudParts(width, height) {
            const parts = [];
            const centerX = width / 2;
            const centerY = height / 2;
            const mainRadius = height * 0.4;
            
            // ä¸»è¦åœ†å½¢éƒ¨åˆ†
            parts.push({
                x: centerX,
                y: centerY,
                radius: mainRadius,
                baseRadius: mainRadius
            });
            
            // æ·»åŠ é¢å¤–çš„åœ†å½¢éƒ¨åˆ†æ¥å½¢æˆäº‘æœµå½¢çŠ¶
            const partCount = 3 + Math.floor(Math.random() * 3); // 3-5ä¸ªéƒ¨åˆ†
            for (let i = 0; i < partCount; i++) {
                const angle = (i / partCount) * Math.PI * 2;
                const distance = mainRadius * (0.3 + Math.random() * 0.4);
                const partRadius = mainRadius * (0.6 + Math.random() * 0.4);
                
                parts.push({
                    x: centerX + Math.cos(angle) * distance,
                    y: centerY + Math.sin(angle) * distance,
                    radius: partRadius,
                    baseRadius: partRadius
                });
            }
            
            return parts;
        }
        
        // åˆå§‹åŒ–äº‘æœµ
        function initClouds() {
            clouds = [];
            cloudParticles = [];
            
            for (let i = 0; i < CLOUD_COUNT; i++) {
                const layer = Math.floor(i / (CLOUD_COUNT / 3)); // åˆ†ä¸º3å±‚
                const baseWidth = 80 + Math.random() * 60;
                const baseHeight = 40 + Math.random() * 20;
                
                clouds.push({
                    id: i,
                    x: Math.random() * GAME_WIDTH,
                    y: Math.random() * (GAME_HEIGHT * 0.7), // äº‘æœµåªå‡ºç°åœ¨ä¸ŠåŠéƒ¨åˆ†
                    baseX: 0, // ç›¸å¯¹ä½ç½®
                    baseY: 0,
                    width: baseWidth,
                    height: baseHeight,
                    baseWidth: baseWidth,
                    baseHeight: baseHeight,
                    speed: (20 + Math.random() * 30 + (layer * 15)) * cloudSpeedMultiplier, // ä¸Šå±‚äº‘æœµé€Ÿåº¦æ›´å¿«
                    opacity: 0.3 + Math.random() * 0.4 - (layer * 0.1), // ä¸Šå±‚äº‘æœµæ›´é€æ˜
                    layer: layer, // è®°å½•äº‘å±‚
                    // é£˜åŠ¨å‚æ•°
                    floatSpeed: (0.5 + Math.random() * 1.5) * globalFloatSpeed, // æµ®åŠ¨é€Ÿåº¦
                    floatAmplitude: (3 + Math.random() * 5) * globalFloatAmplitude, // æµ®åŠ¨å¹…åº¦
                    floatPhase: Math.random() * Math.PI * 2, // æµ®åŠ¨ç›¸ä½
                    // å½¢çŠ¶å˜åŒ–å‚æ•°
                    morphSpeed: (0.2 + Math.random() * 0.3) * globalMorphSpeed, // å˜å½¢é€Ÿåº¦
                    morphAmplitude: (0.05 + Math.random() * 0.1) * globalMorphAmplitude, // å˜å½¢å¹…åº¦
                    morphPhase: Math.random() * Math.PI * 2, // å˜å½¢ç›¸ä½
                    // äº‘æœµç»„æˆéƒ¨åˆ†ï¼ˆç”¨äºç»˜åˆ¶æ›´å¤æ‚çš„äº‘æœµï¼‰
                    parts: generateCloudParts(baseWidth, baseHeight),
                    // çº¹ç†å‚æ•°
                    textureCount: 2 + Math.floor(Math.random() * 4),
                    hasParticles: Math.random() < 0.3, // 30%çš„äº‘æœµæœ‰ç²’å­æ•ˆæœ
                    particleTimer: 0,
                    particleInterval: 1 + Math.random() * 2
                });
            }
            
            updateCloudInfo();
        }
        
        // æ›´æ–°äº‘æœµ
        function updateClouds(deltaTime) {
            const startTime = performance.now();
            
            clouds.forEach(cloud => {
                // æ°´å¹³ç§»åŠ¨
                cloud.x -= cloud.speed * deltaTime;
                
                // æ›´æ–°æµ®åŠ¨ç›¸ä½
                cloud.floatPhase += cloud.floatSpeed * deltaTime;
                
                // è®¡ç®—å‚ç›´æµ®åŠ¨ä½ç½®
                cloud.baseY = Math.sin(cloud.floatPhase) * cloud.floatAmplitude;
                
                // æ›´æ–°å½¢çŠ¶å˜åŒ–ç›¸ä½
                cloud.morphPhase += cloud.morphSpeed * deltaTime;
                
                // è®¡ç®—å½¢çŠ¶å˜åŒ–å› å­
                const morphFactor = 1 + Math.sin(cloud.morphPhase) * cloud.morphAmplitude;
                
                // æ›´æ–°äº‘æœµå„éƒ¨åˆ†çš„å¤§å°ï¼ˆå½¢çŠ¶å˜åŒ–ï¼‰
                cloud.parts.forEach(part => {
                    part.radius = part.baseRadius * morphFactor;
                });
                
                // æ›´æ–°æ•´ä½“äº‘æœµå¤§å°
                cloud.width = cloud.baseWidth * (1 + Math.sin(cloud.morphPhase) * cloud.morphAmplitude * 0.5);
                cloud.height = cloud.baseHeight * (1 + Math.cos(cloud.morphPhase) * cloud.morphAmplitude * 0.5);
                
                // äº‘æœµç§»å‡ºå±å¹•åä»å³ä¾§é‡æ–°è¿›å…¥
                if (cloud.x + cloud.width < 0) {
                    cloud.x = GAME_WIDTH;
                    cloud.y = Math.random() * (GAME_HEIGHT * 0.7);
                    cloud.opacity = 0.3 + Math.random() * 0.4 - (cloud.layer * 0.1);
                    // é‡ç½®é£˜åŠ¨å‚æ•°
                    cloud.floatPhase = Math.random() * Math.PI * 2;
                    cloud.morphPhase = Math.random() * Math.PI * 2;
                    // é‡æ–°ç”Ÿæˆäº‘æœµéƒ¨åˆ†
                    cloud.parts = generateCloudParts(cloud.baseWidth, cloud.baseHeight);
                }
                
                // æ›´æ–°ç²’å­æ•ˆæœ
                if (showParticles && cloud.hasParticles) {
                    cloud.particleTimer += deltaTime;
                    if (cloud.particleTimer >= cloud.particleInterval) {
                        createCloudParticle(cloud);
                        cloud.particleTimer = 0;
                    }
                }
            });
            
            // æ›´æ–°ç²’å­
            updateParticles(deltaTime);
            
            updateTime = performance.now() - startTime;
        }
        
        // åˆ›å»ºäº‘æœµç²’å­
        function createCloudParticle(cloud) {
            const particleCount = 1 + Math.floor(Math.random() * 2);
            
            for (let i = 0; i < particleCount; i++) {
                const particleX = cloud.x + Math.random() * cloud.width;
                const particleY = cloud.y + Math.random() * cloud.height;
                
                cloudParticles.push({
                    x: particleX,
                    y: particleY,
                    vx: -cloud.speed * 0.5 + (Math.random() - 0.5) * 20,
                    vy: (Math.random() - 0.5) * 20 - 10,
                    life: 1.0,
                    maxLife: 1.0 + Math.random() * 1.0,
                    size: 1 + Math.random() * 2,
                    opacity: 0.5 + Math.random() * 0.5,
                    color: `rgba(255, 255, 255, ${0.5 + Math.random() * 0.5})`
                });
            }
        }
        
        // æ›´æ–°ç²’å­
        function updateParticles(deltaTime) {
            cloudParticles.forEach((particle, index) => {
                particle.x += particle.vx * deltaTime;
                particle.y += particle.vy * deltaTime;
                particle.life -= deltaTime / particle.maxLife;
                particle.opacity = particle.life;
                
                // ç§»é™¤æ­»äº¡ç²’å­
                if (particle.life <= 0) {
                    cloudParticles.splice(index, 1);
                }
            });
        }
        
        // ç»˜åˆ¶äº‘æœµå½¢çŠ¶ - ä½¿ç”¨æ›´è‡ªç„¶çš„äº‘æœµè½®å»“å’Œé£˜åŠ¨æ•ˆæœ
        function drawCloud(ctx, x, y, width, height, parts, floatY, opacity, showTextures = true) {
            ctx.beginPath();
            
            // åº”ç”¨æµ®åŠ¨æ•ˆæœ
            const actualY = y + floatY;
            const centerY = actualY + height * 0.4; // äº‘æœµä¸­å¿ƒåä¸Š
            
            // ä½¿ç”¨äº‘æœµçš„å„ä¸ªéƒ¨åˆ†ç»˜åˆ¶
            if (parts && parts.length > 0) {
                // å…ˆç»˜åˆ¶ä¸»è¦éƒ¨åˆ†
                const mainPart = parts[0];
                ctx.arc(x + mainPart.x, centerY + mainPart.y - height * 0.4, mainPart.radius, 0, Math.PI * 2);
                
                // ç»˜åˆ¶å…¶ä»–éƒ¨åˆ†
                for (let i = 1; i < parts.length; i++) {
                    const part = parts[i];
                    ctx.arc(x + part.x, centerY + part.y - height * 0.4, part.radius, 0, Math.PI * 2);
                }
                
                // æ·»åŠ åº•éƒ¨è¿æ¥éƒ¨åˆ†
                const minX = x + Math.min(...parts.map(p => p.x - p.radius));
                const maxX = x + Math.max(...parts.map(p => p.x + p.radius));
                const maxY = centerY + Math.max(...parts.map(p => p.y - height * 0.4 + p.radius));
                
                ctx.rect(minX, maxY, maxX - minX, height * 0.2);
            } else {
                // å¤‡ç”¨ç»˜åˆ¶æ–¹æ³•ï¼ˆå½“partsä¸å¯ç”¨æ—¶ï¼‰
                const radius = height * 0.4;
                
                // ä¸»è¦äº‘æœµéƒ¨åˆ†
                ctx.arc(x + width * 0.25, centerY, radius, 0, Math.PI * 2);
                ctx.arc(x + width * 0.5, centerY - radius * 0.2, radius * 0.9, 0, Math.PI * 2);
                ctx.arc(x + width * 0.75, centerY, radius, 0, Math.PI * 2);
                ctx.arc(x + width * 0.4, centerY + radius * 0.3, radius * 0.7, 0, Math.PI * 2);
                ctx.arc(x + width * 0.65, centerY + radius * 0.2, radius * 0.6, 0, Math.PI * 2);
                
                // äº‘æœµåº•éƒ¨
                ctx.rect(x, centerY + radius * 0.3, width, height * 0.3);
            }
            
            ctx.fill();
            
            // æ·»åŠ äº‘æœµå†…éƒ¨çº¹ç†
            if (showTextures && Math.random() < 0.6) { // 60%çš„æ¦‚ç‡æ·»åŠ çº¹ç†
                const originalAlpha = ctx.globalAlpha;
                ctx.globalAlpha *= 0.3; // é™ä½çº¹ç†é€æ˜åº¦
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                
                // ç»˜åˆ¶ä¸€äº›å°çš„åœ†å½¢ä½œä¸ºçº¹ç†
                for (let i = 0; i < 5; i++) {
                    const textureX = x + Math.random() * width * 0.8 + width * 0.1;
                    const textureY = actualY + Math.random() * height * 0.6 + height * 0.2;
                    const textureRadius = height * 0.05 + Math.random() * height * 0.1;
                    
                    ctx.beginPath();
                    ctx.arc(textureX, textureY, textureRadius, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                ctx.globalAlpha = originalAlpha;
            }
        }
        
        // ç»˜åˆ¶äº‘æœµ
        function drawClouds() {
            const startTime = performance.now();
            
            // ç»˜åˆ¶èƒŒæ™¯æ¸å˜
            const gradient = ctx.createLinearGradient(0, 0, 0, GAME_HEIGHT);
            gradient.addColorStop(0, '#0f3460');
            gradient.addColorStop(1, '#16213e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // æŒ‰å±‚æ’åºäº‘æœµï¼ˆä»ååˆ°å‰ï¼‰
            const sortedClouds = [...clouds].sort((a, b) => b.layer - a.layer);
            
            // ç»˜åˆ¶äº‘æœµ
            sortedClouds.forEach(cloud => {
                // ä¿å­˜å½“å‰çŠ¶æ€
                ctx.save();
                
                // è®¾ç½®é€æ˜åº¦
                ctx.globalAlpha = cloud.opacity;
                
                // è®¾ç½®äº‘æœµé¢œè‰²
                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                
                // ç»˜åˆ¶äº‘æœµä¸»ä½“
                drawCloud(ctx, cloud.x, cloud.y, cloud.width, cloud.height, cloud.parts, cloud.baseY, cloud.opacity, showTextures);
                
                // æ·»åŠ äº‘æœµè¾¹ç¼˜å…‰æ™•æ•ˆæœ
                if (Math.random() < 0.3) {
                    ctx.globalAlpha = cloud.opacity * 0.2;
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    drawCloud(ctx, cloud.x - 5, cloud.y - 5, cloud.width + 10, cloud.height + 10, cloud.parts, cloud.baseY, cloud.opacity * 0.2, false);
                }
                
                // æ¢å¤çŠ¶æ€
                ctx.restore();
            });
            
            // ç»˜åˆ¶ç²’å­
            if (showParticles) {
                cloudParticles.forEach(particle => {
                    ctx.save();
                    ctx.globalAlpha = particle.opacity;
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
            }
            
            renderTime = performance.now() - startTime;
        }
        
        // æ›´æ–°äº‘æœµä¿¡æ¯æ˜¾ç¤º
        function updateCloudInfo() {
            const cloudDetails = document.getElementById('cloudDetails');
            let html = '';
            
            clouds.forEach(cloud => {
                html += `
                    <div class="cloud-item">
                        <strong>äº‘æœµ #${cloud.id}</strong><br>
                        ä½ç½®: (${Math.floor(cloud.x)}, ${Math.floor(cloud.y)})<br>
                        å¤§å°: ${Math.floor(cloud.width)}x${Math.floor(cloud.height)}<br>
                        é€Ÿåº¦: ${Math.floor(cloud.speed)} px/s<br>
                        é€æ˜åº¦: ${(cloud.opacity * 100).toFixed(0)}%<br>
                        å±‚çº§: ${cloud.layer}<br>
                        æµ®åŠ¨: ${cloud.baseY.toFixed(1)}px<br>
                        ç²’å­: ${cloud.hasParticles ? 'æ˜¯' : 'å¦'}
                    </div>
                `;
            });
            
            cloudDetails.innerHTML = html;
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('totalClouds').textContent = CLOUD_COUNT;
            document.getElementById('activeClouds').textContent = clouds.length;
        }
        
        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            const currentTime = performance.now();
            const deltaTime = (currentTime - lastUpdateTime) / 1000; // è½¬æ¢ä¸ºç§’
            lastUpdateTime = currentTime;
            
            // æ›´æ–°FPS
            frameCount++;
            if (currentTime - lastFpsUpdate >= 1000) {
                currentFps = Math.round(frameCount * 1000 / (currentTime - lastFpsUpdate));
                frameCount = 0;
                lastFpsUpdate = currentTime;
            }
            
            if (!isPaused) {
                gameTime += deltaTime;
                
                // æ›´æ–°äº‘æœµ
                updateClouds(deltaTime);
            }
            
            // æ¸²æŸ“äº‘æœµ
            drawClouds();
            
            // æ›´æ–°UI
            document.getElementById('gameTime').textContent = gameTime.toFixed(1);
            document.getElementById('fps').textContent = currentFps;
            document.getElementById('renderTime').textContent = renderTime.toFixed(1);
            document.getElementById('updateTime').textContent = updateTime.toFixed(1);
            
            // ç»§ç»­æ¸¸æˆå¾ªç¯
            requestAnimationFrame(gameLoop);
        }
        
        // åˆå§‹åŒ–æ§åˆ¶äº‹ä»¶
        function initControls() {
            // äº‘æœµæ•°é‡æ§åˆ¶
            const cloudCountSlider = document.getElementById('cloudCount');
            const cloudCountValue = document.getElementById('cloudCountValue');
            cloudCountSlider.addEventListener('input', function() {
                CLOUD_COUNT = parseInt(this.value);
                cloudCountValue.textContent = CLOUD_COUNT;
                initClouds();
            });
            
            // æµ®åŠ¨é€Ÿåº¦æ§åˆ¶
            const floatSpeedSlider = document.getElementById('floatSpeed');
            const floatSpeedValue = document.getElementById('floatSpeedValue');
            floatSpeedSlider.addEventListener('input', function() {
                globalFloatSpeed = parseFloat(this.value);
                floatSpeedValue.textContent = globalFloatSpeed.toFixed(1);
                
                // æ›´æ–°ç°æœ‰äº‘æœµçš„æµ®åŠ¨é€Ÿåº¦
                clouds.forEach(cloud => {
                    cloud.floatSpeed = (0.5 + Math.random() * 1.5) * globalFloatSpeed;
                });
            });
            
            // æµ®åŠ¨å¹…åº¦æ§åˆ¶
            const floatAmplitudeSlider = document.getElementById('floatAmplitude');
            const floatAmplitudeValue = document.getElementById('floatAmplitudeValue');
            floatAmplitudeSlider.addEventListener('input', function() {
                globalFloatAmplitude = parseInt(this.value);
                floatAmplitudeValue.textContent = globalFloatAmplitude;
                
                // æ›´æ–°ç°æœ‰äº‘æœµçš„æµ®åŠ¨å¹…åº¦
                clouds.forEach(cloud => {
                    cloud.floatAmplitude = (3 + Math.random() * 5) * globalFloatAmplitude / 5;
                });
            });
            
            // å˜å½¢é€Ÿåº¦æ§åˆ¶
            const morphSpeedSlider = document.getElementById('morphSpeed');
            const morphSpeedValue = document.getElementById('morphSpeedValue');
            morphSpeedSlider.addEventListener('input', function() {
                globalMorphSpeed = parseFloat(this.value);
                morphSpeedValue.textContent = globalMorphSpeed.toFixed(2);
                
                // æ›´æ–°ç°æœ‰äº‘æœµçš„å˜å½¢é€Ÿåº¦
                clouds.forEach(cloud => {
                    cloud.morphSpeed = (0.2 + Math.random() * 0.3) * globalMorphSpeed;
                });
            });
            
            // å˜å½¢å¹…åº¦æ§åˆ¶
            const morphAmplitudeSlider = document.getElementById('morphAmplitude');
            const morphAmplitudeValue = document.getElementById('morphAmplitudeValue');
            morphAmplitudeSlider.addEventListener('input', function() {
                globalMorphAmplitude = parseFloat(this.value);
                morphAmplitudeValue.textContent = globalMorphAmplitude.toFixed(2);
                
                // æ›´æ–°ç°æœ‰äº‘æœµçš„å˜å½¢å¹…åº¦
                clouds.forEach(cloud => {
                    cloud.morphAmplitude = (0.05 + Math.random() * 0.1) * globalMorphAmplitude / 0.1;
                });
            });
            
            // ç§»åŠ¨é€Ÿåº¦æ§åˆ¶
            const cloudSpeedSlider = document.getElementById('cloudSpeed');
            const cloudSpeedValue = document.getElementById('cloudSpeedValue');
            cloudSpeedSlider.addEventListener('input', function() {
                cloudSpeedMultiplier = parseFloat(this.value);
                cloudSpeedValue.textContent = cloudSpeedMultiplier.toFixed(1);
                
                // æ›´æ–°ç°æœ‰äº‘æœµçš„ç§»åŠ¨é€Ÿåº¦
                clouds.forEach(cloud => {
                    const layer = cloud.layer;
                    cloud.speed = (20 + Math.random() * 30 + (layer * 15)) * cloudSpeedMultiplier;
                });
            });
            
            // æ˜¾ç¤º/éšè—çº¹ç†
            const showTexturesCheckbox = document.getElementById('showTextures');
            showTexturesCheckbox.addEventListener('change', function() {
                showTextures = this.checked;
            });
            
            // æ˜¾ç¤º/éšè—ç²’å­æ•ˆæœ
            const showParticlesCheckbox = document.getElementById('showParticles');
            showParticlesCheckbox.addEventListener('change', function() {
                showParticles = this.checked;
                if (!showParticles) {
                    cloudParticles = []; // æ¸…é™¤æ‰€æœ‰ç²’å­
                }
            });
            
            // é‡ç½®äº‘æœµ
            const resetBtn = document.getElementById('resetBtn');
            resetBtn.addEventListener('click', function() {
                initClouds();
            });
            
            // å¯¼å‡ºé…ç½®
            const exportBtn = document.getElementById('exportBtn');
            exportBtn.addEventListener('click', function() {
                const config = {
                    cloudCount: CLOUD_COUNT,
                    floatSpeed: globalFloatSpeed,
                    floatAmplitude: globalFloatAmplitude,
                    morphSpeed: globalMorphSpeed,
                    morphAmplitude: globalMorphAmplitude,
                    cloudSpeed: cloudSpeedMultiplier,
                    showTextures: showTextures,
                    showParticles: showParticles
                };
                
                const configJson = JSON.stringify(config, null, 2);
                const blob = new Blob([configJson], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'cloud_config.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space') {
                    isPaused = !isPaused;
                } else if (event.code === 'KeyR') {
                    initClouds();
                }
            });
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function init() {
            // åˆå§‹åŒ–äº‘æœµ
            initClouds();
            
            // åˆå§‹åŒ–æ§åˆ¶
            initControls();
            
            // è®¾ç½®æ¸¸æˆå¾ªç¯
            lastUpdateTime = performance.now();
            lastFpsUpdate = lastUpdateTime;
            gameLoop();
        }
        
        // å¯åŠ¨æ¸¸æˆ
        init();
    </script>
</body>
</html>