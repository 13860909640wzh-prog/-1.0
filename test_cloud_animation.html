<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‘æœµé£˜åŠ¨æ•ˆæœæµ‹è¯• - å¤§åœ£è·‘é…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', 'Arial', sans-serif;
            background-color: #000;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        
        canvas {
            display: block;
            background-color: #0f3460;
            border: 2px solid #ffd700;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            max-width: 300px;
        }
        
        .controls h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .control-group {
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .btn {
            padding: 8px 16px;
            font-size: 14px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 5px 0;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 100;
            font-size: 14px;
            min-width: 200px;
        }
        
        .info h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .info-item {
            margin-bottom: 5px;
        }
        
        .cloud-selector {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .cloud-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .cloud-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .cloud-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .cloud-item.selected {
            background: rgba(255, 215, 0, 0.3);
            border: 1px solid #ffd700;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="canvas" width="800" height="600"></canvas>
    </div>
    
    <div class="controls">
        <h3>â˜ï¸ äº‘æœµæ§åˆ¶</h3>
        <div class="control-group">
            <button id="resetBtn" class="btn">é‡ç½®äº‘æœµ</button>
        </div>
        <div class="control-group">
            <button id="addCloudBtn" class="btn">æ·»åŠ äº‘æœµ</button>
        </div>
        <div class="control-group">
            <button id="removeCloudBtn" class="btn">ç§»é™¤äº‘æœµ</button>
        </div>
        
        <div class="control-group">
            <label for="timeSpeed">æ—¶é—´æµé€Ÿ: <span id="timeSpeedValue">1</span></label>
            <input type="range" id="timeSpeed" min="0.1" max="3" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <label for="globalSpeed">å…¨å±€é€Ÿåº¦: <span id="globalSpeedValue">1</span></label>
            <input type="range" id="globalSpeed" min="0" max="3" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <label for="globalAmplitude">å…¨å±€å¹…åº¦: <span id="globalAmplitudeValue">1</span></label>
            <input type="range" id="globalAmplitude" min="0" max="3" step="0.1" value="1">
        </div>
        
        <div class="cloud-selector">
            <h4 style="color: #ffd700; margin-bottom: 10px;">é€‰æ‹©äº‘æœµç¼–è¾‘</h4>
            <div class="cloud-list" id="cloudList">
                <!-- äº‘æœµåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div id="selectedCloudControls" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
            <h4 style="color: #ffd700; margin-bottom: 10px;">äº‘æœµå‚æ•°</h4>
            
            <div class="control-group">
                <label for="cloudSpeed">é£˜åŠ¨é€Ÿåº¦: <span id="cloudSpeedValue">1</span></label>
                <input type="range" id="cloudSpeed" min="0" max="5" step="0.1" value="1">
            </div>
            
            <div class="control-group">
                <label for="cloudAmplitude">é£˜åŠ¨å¹…åº¦: <span id="cloudAmplitudeValue">10</span></label>
                <input type="range" id="cloudAmplitude" min="0" max="30" step="1" value="10">
            </div>
            
            <div class="control-group">
                <label for="cloudDeformation">å˜å½¢å¹…åº¦: <span id="cloudDeformationValue">0.1</span></label>
                <input type="range" id="cloudDeformation" min="0" max="0.5" step="0.01" value="0.1">
            </div>
            
            <div class="control-group">
                <label for="cloudRotation">æ—‹è½¬é€Ÿåº¦: <span id="cloudRotationValue">0</span></label>
                <input type="range" id="cloudRotation" min="-1" max="1" step="0.05" value="0">
            </div>
            
            <div class="control-group">
                <label>é£˜åŠ¨æ¨¡å¼:</label>
                <select id="cloudPattern" style="width: 100%; padding: 5px; margin-top: 5px; background: rgba(0,0,0,0.5); color: white; border: 1px solid rgba(255,255,255,0.3);">
                    <option value="0">ä¸Šä¸‹é£˜åŠ¨</option>
                    <option value="1">æ³¢æµªå½¢</option>
                    <option value="2">æ—‹è½¬é£˜åŠ¨</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="info">
        <h3>ğŸ“Š äº‘æœµä¿¡æ¯</h3>
        <div class="info-item">äº‘æœµæ•°é‡: <span id="cloudCount">8</span></div>
        <div class="info-item">æ¸¸æˆæ—¶é—´: <span id="gameTime">0.0</span>s</div>
        <div class="info-item">FPS: <span id="fps">60</span></div>
        
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
            <h4 style="color: #ffd700; margin-bottom: 10px;">é€‰ä¸­çš„äº‘æœµ</h4>
            <div class="info-item">ID: <span id="selectedCloudId">-</span></div>
            <div class="info-item">æ¨¡å¼: <span id="selectedCloudPattern">-</span></div>
            <div class="info-item">ä½ç½®: <span id="selectedCloudPosition">-</span></div>
            <div class="info-item">çŠ¶æ€: <span id="selectedCloudStatus">-</span></div>
        </div>
    </div>

    <script>
        // æ¸¸æˆå¸¸é‡
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 600;
        const CLOUD_COUNT = 8;
        
        // æ§åˆ¶å‚æ•°
        let timeSpeedMultiplier = 1;
        let globalSpeedMultiplier = 1;
        let globalAmplitudeMultiplier = 1;
        let selectedCloudIndex = -1;
        
        // æ¸¸æˆçŠ¶æ€
        let gameTime = 0;
        let lastUpdateTime = 0;
        
        // æ€§èƒ½ç›‘æ§
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let currentFps = 60;
        
        // åŠ¨æ€èƒŒæ™¯å…ƒç´ 
        let clouds = [];
        
        // åˆå§‹åŒ–åŠ¨æ€èƒŒæ™¯
        function initBackground() {
            // åˆå§‹åŒ–äº‘æœµ - åˆ†å±‚è®¾è®¡
            clouds = [];
            for (let i = 0; i < CLOUD_COUNT; i++) {
                const layer = Math.floor(i / (CLOUD_COUNT / 3)); // åˆ†ä¸º3å±‚
                const pattern = Math.floor(Math.random() * 3); // 0: ä¸Šä¸‹é£˜åŠ¨, 1: æ³¢æµªå½¢, 2: æ—‹è½¬é£˜åŠ¨
                
                clouds.push({
                    id: i,
                    x: Math.random() * GAME_WIDTH,
                    y: Math.random() * (GAME_HEIGHT * 0.7), // äº‘æœµåªå‡ºç°åœ¨ä¸ŠåŠéƒ¨åˆ†
                    width: 80 + Math.random() * 60,
                    height: 40 + Math.random() * 20,
                    speed: 20 + Math.random() * 30 + (layer * 15), // ä¸Šå±‚äº‘æœµé€Ÿåº¦æ›´å¿«
                    opacity: 0.3 + Math.random() * 0.4 - (layer * 0.1), // ä¸Šå±‚äº‘æœµæ›´é€æ˜
                    layer: layer, // è®°å½•äº‘å±‚
                    pattern: pattern, // é£˜åŠ¨æ¨¡å¼
                    amplitude: 5 + Math.random() * 15, // é£˜åŠ¨å¹…åº¦
                    patternSpeed: 0.5 + Math.random() * 2, // é£˜åŠ¨é€Ÿåº¦
                    patternPhase: Math.random() * Math.PI * 2, // åˆå§‹ç›¸ä½
                    rotationSpeed: pattern === 2 ? (Math.random() - 0.5) * 0.2 : 0, // æ—‹è½¬é€Ÿåº¦
                    rotationAngle: 0, // å½“å‰æ—‹è½¬è§’åº¦
                    originalHeight: 40 + Math.random() * 20, // åŸå§‹é«˜åº¦
                    deformation: Math.random() * 0.1 + 0.05, // å½¢çŠ¶å˜åŒ–å¹…åº¦
                    color: pattern === 0 ? '#ffffff' : pattern === 1 ? '#f0f8ff' : '#e6f7ff' // ä¸åŒæ¨¡å¼ä¸åŒé¢œè‰²
                });
            }
            
            updateCloudList();
            updateInfo();
        }
        
        // æ›´æ–°åŠ¨æ€èƒŒæ™¯
        function updateBackground(deltaTime) {
            const scaledDeltaTime = deltaTime * timeSpeedMultiplier;
            
            // æ›´æ–°äº‘æœµä½ç½® - å¢å¼ºé£˜åŠ¨æ•ˆæœ
            clouds.forEach(cloud => {
                // æ°´å¹³ç§»åŠ¨
                cloud.x -= cloud.speed * scaledDeltaTime * globalSpeedMultiplier;
                
                // æ›´æ–°é£˜åŠ¨ç›¸ä½
                cloud.patternPhase += cloud.patternSpeed * scaledDeltaTime * globalSpeedMultiplier;
                
                // æ ¹æ®ä¸åŒçš„é£˜åŠ¨æ¨¡å¼æ›´æ–°äº‘æœµä½ç½®å’Œå½¢çŠ¶
                switch(cloud.pattern) {
                    case 0: // ä¸Šä¸‹é£˜åŠ¨
                        cloud.y += Math.sin(cloud.patternPhase) * cloud.amplitude * scaledDeltaTime * globalAmplitudeMultiplier;
                        break;
                    case 1: // æ³¢æµªå½¢é£˜åŠ¨
                        cloud.y += Math.sin(cloud.patternPhase) * cloud.amplitude * scaledDeltaTime * globalAmplitudeMultiplier;
                        cloud.x += Math.cos(cloud.patternPhase * 0.5) * cloud.amplitude * 0.3 * scaledDeltaTime * globalAmplitudeMultiplier;
                        break;
                    case 2: // æ—‹è½¬é£˜åŠ¨
                        cloud.y += Math.sin(cloud.patternPhase) * cloud.amplitude * scaledDeltaTime * globalAmplitudeMultiplier;
                        cloud.rotationAngle += cloud.rotationSpeed * scaledDeltaTime * globalSpeedMultiplier;
                        // æ—‹è½¬æ—¶è½»å¾®æ”¹å˜é«˜åº¦
                        cloud.height = cloud.originalHeight * (1 + Math.sin(cloud.patternPhase) * cloud.deformation);
                        break;
                }
                
                // äº‘æœµç§»å‡ºå±å¹•åä»å³ä¾§é‡æ–°è¿›å…¥
                if (cloud.x + cloud.width < 0) {
                    cloud.x = GAME_WIDTH;
                    cloud.y = Math.random() * (GAME_HEIGHT * 0.7);
                    cloud.patternPhase = Math.random() * Math.PI * 2; // é‡æ–°éšæœºç›¸ä½
                    cloud.rotationAngle = 0; // é‡ç½®æ—‹è½¬è§’åº¦
                }
            });
            
            // æ›´æ–°ä¿¡æ¯æ˜¾ç¤º
            updateInfo();
        }
        
        // ç»˜åˆ¶äº‘æœµå½¢çŠ¶ - å¢å¼ºé£˜åŠ¨æ•ˆæœçš„äº‘æœµè½®å»“
        function drawCloud(ctx, cloud) {
            const { x, y, width, height, rotationAngle, deformation, patternPhase, color } = cloud;
            
            ctx.save();
            
            // è®¾ç½®äº‘æœµä¸­å¿ƒç‚¹
            const centerX = x + width / 2;
            const centerY = y + height * 0.4;
            
            // åº”ç”¨æ—‹è½¬å˜æ¢
            ctx.translate(centerX, centerY);
            ctx.rotate(rotationAngle);
            ctx.translate(-centerX, -centerY);
            
            // è®¡ç®—å˜å½¢ç³»æ•°
            const scaleX = 1 + Math.sin(patternPhase * 1.5) * deformation;
            const scaleY = 1 + Math.cos(patternPhase * 1.2) * deformation;
            
            // ç»˜åˆ¶å˜å½¢çš„äº‘æœµ
            ctx.beginPath();
            
            // è°ƒæ•´äº‘æœµå‚æ•°ä»¥é€‚åº”å˜å½¢
            const adjustedHeight = height * scaleY;
            const radius = adjustedHeight * 0.4;
            const adjustedCenterY = y + adjustedHeight * 0.4;
            
            // ä¸»è¦äº‘æœµéƒ¨åˆ† - ä½¿ç”¨ä¸åŒå¤§å°å’Œä½ç½®çš„åœ†å½¢ç»„åˆ
            const part1X = x + width * 0.25 * scaleX;
            const part2X = x + width * 0.5 * scaleX;
            const part3X = x + width * 0.75 * scaleX;
            const part4X = x + width * 0.4 * scaleX;
            const part5X = x + width * 0.65 * scaleX;
            
            // æ ¹æ®é£˜åŠ¨ç›¸ä½è°ƒæ•´å„ä¸ªéƒ¨åˆ†çš„é«˜åº¦ï¼Œåˆ›é€ æ›´è‡ªç„¶çš„é£˜åŠ¨æ•ˆæœ
            const part1Y = adjustedCenterY + Math.sin(patternPhase) * radius * 0.2;
            const part2Y = adjustedCenterY - radius * 0.2 + Math.cos(patternPhase * 0.8) * radius * 0.15;
            const part3Y = adjustedCenterY + Math.sin(patternPhase * 1.2) * radius * 0.15;
            const part4Y = adjustedCenterY + radius * 0.3 + Math.cos(patternPhase * 1.5) * radius * 0.1;
            const part5Y = adjustedCenterY + radius * 0.2 + Math.sin(patternPhase * 0.6) * radius * 0.12;
            
            // ç»˜åˆ¶äº‘æœµçš„å„ä¸ªéƒ¨åˆ†
            ctx.arc(part1X, part1Y, radius * (1 + Math.sin(patternPhase) * 0.1), 0, Math.PI * 2);
            ctx.arc(part2X, part2Y, radius * 0.9 * (1 + Math.cos(patternPhase * 0.7) * 0.1), 0, Math.PI * 2);
            ctx.arc(part3X, part3Y, radius * (1 + Math.sin(patternPhase * 1.3) * 0.08), 0, Math.PI * 2);
            ctx.arc(part4X, part4Y, radius * 0.7 * (1 + Math.cos(patternPhase * 1.1) * 0.12), 0, Math.PI * 2);
            ctx.arc(part5X, part5Y, radius * 0.6 * (1 + Math.sin(patternPhase * 0.9) * 0.09), 0, Math.PI * 2);
            
            // äº‘æœµåº•éƒ¨ - ç¨å¾®å¼¯æ›²çš„åº•éƒ¨è¾¹ç¼˜
            ctx.moveTo(x, adjustedCenterY + radius * 0.3);
            ctx.quadraticCurveTo(
                x + width * 0.5 * scaleX, 
                adjustedCenterY + radius * 0.5 + Math.sin(patternPhase * 0.5) * radius * 0.2, 
                x + width * scaleX, 
                adjustedCenterY + radius * 0.3
            );
            ctx.lineTo(x + width * scaleX, adjustedCenterY + radius * 0.3);
            ctx.lineTo(x, adjustedCenterY + radius * 0.3);
            
            // å¡«å……äº‘æœµä¸»ä½“
            ctx.fillStyle = color;
            ctx.fill();
            
            // æ·»åŠ äº‘æœµå†…éƒ¨çº¹ç†
            ctx.globalAlpha *= 0.3;
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            
            // ç»˜åˆ¶ä¸€äº›å°åœ†å½¢ä½œä¸ºäº‘æœµçº¹ç†
            const textureCount = 3 + Math.floor(Math.random() * 3);
            for (let i = 0; i < textureCount; i++) {
                const textureX = x + Math.random() * width * scaleX;
                const textureY = adjustedCenterY - radius * 0.2 + Math.random() * radius * 0.8;
                const textureRadius = radius * 0.1 + Math.random() * radius * 0.15;
                
                ctx.beginPath();
                ctx.arc(textureX, textureY, textureRadius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // å¦‚æœæ˜¯é€‰ä¸­çš„äº‘æœµï¼Œç»˜åˆ¶è¾¹æ¡†
            if (selectedCloudIndex === cloud.id) {
                ctx.globalAlpha = 1;
                ctx.strokeStyle = '#ffd700';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.strokeRect(x - 5, y - 5, width + 10, height + 10);
            }
            
            ctx.restore();
        }
        
        // ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            // ç»˜åˆ¶æ¸å˜å¤©ç©ºèƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, 0, GAME_HEIGHT);
            gradient.addColorStop(0, '#0f3460'); // æ·±è“è‰²å¤©ç©ºé¡¶éƒ¨
            gradient.addColorStop(1, '#16213e'); // ç¨æµ…çš„è“è‰²åº•éƒ¨
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // ç»˜åˆ¶äº‘æœµ
            clouds.forEach(cloud => {
                ctx.globalAlpha = cloud.opacity;
                drawCloud(ctx, cloud);
            });
            
            // é‡ç½®é€æ˜åº¦
            ctx.globalAlpha = 1;
        }
        
        // æ›´æ–°äº‘æœµåˆ—è¡¨
        function updateCloudList() {
            const cloudList = document.getElementById('cloudList');
            cloudList.innerHTML = '';
            
            clouds.forEach((cloud, index) => {
                const cloudItem = document.createElement('div');
                cloudItem.className = `cloud-item ${selectedCloudIndex === cloud.id ? 'selected' : ''}`;
                cloudItem.innerHTML = `
                    <strong>äº‘æœµ ${cloud.id}</strong><br>
                    æ¨¡å¼: ${getPatternName(cloud.pattern)}<br>
                    é€Ÿåº¦: ${cloud.patternSpeed.toFixed(1)}
                `;
                cloudItem.onclick = () => selectCloud(index);
                cloudList.appendChild(cloudItem);
            });
        }
        
        // è·å–é£˜åŠ¨æ¨¡å¼åç§°
        function getPatternName(pattern) {
            switch(pattern) {
                case 0: return 'ä¸Šä¸‹é£˜åŠ¨';
                case 1: return 'æ³¢æµªå½¢';
                case 2: return 'æ—‹è½¬é£˜åŠ¨';
                default: return 'æœªçŸ¥';
            }
        }
        
        // é€‰æ‹©äº‘æœµ
        function selectCloud(index) {
            if (index >= 0 && index < clouds.length) {
                selectedCloudIndex = clouds[index].id;
                updateCloudList();
                showSelectedCloudControls();
                updateSelectedCloudControls();
            }
        }
        
        // æ˜¾ç¤ºé€‰ä¸­äº‘æœµçš„æ§åˆ¶
        function showSelectedCloudControls() {
            document.getElementById('selectedCloudControls').style.display = 'block';
        }
        
        // éšè—é€‰ä¸­äº‘æœµçš„æ§åˆ¶
        function hideSelectedCloudControls() {
            document.getElementById('selectedCloudControls').style.display = 'none';
        }
        
        // æ›´æ–°é€‰ä¸­äº‘æœµçš„æ§åˆ¶
        function updateSelectedCloudControls() {
            if (selectedCloudIndex === -1) return;
            
            const cloud = clouds.find(c => c.id === selectedCloudIndex);
            if (!cloud) return;
            
            document.getElementById('cloudSpeed').value = cloud.patternSpeed;
            document.getElementById('cloudSpeedValue').textContent = cloud.patternSpeed.toFixed(1);
            
            document.getElementById('cloudAmplitude').value = cloud.amplitude;
            document.getElementById('cloudAmplitudeValue').textContent = cloud.amplitude.toFixed(0);
            
            document.getElementById('cloudDeformation').value = cloud.deformation;
            document.getElementById('cloudDeformationValue').textContent = cloud.deformation.toFixed(2);
            
            document.getElementById('cloudRotation').value = cloud.rotationSpeed;
            document.getElementById('cloudRotationValue').textContent = cloud.rotationSpeed.toFixed(2);
            
            document.getElementById('cloudPattern').value = cloud.pattern;
            
            // æ›´æ–°é€‰ä¸­äº‘æœµä¿¡æ¯
            document.getElementById('selectedCloudId').textContent = cloud.id;
            document.getElementById('selectedCloudPattern').textContent = getPatternName(cloud.pattern);
            document.getElementById('selectedCloudPosition').textContent = `X: ${Math.floor(cloud.x)}, Y: ${Math.floor(cloud.y)}`;
            document.getElementById('selectedCloudStatus').textContent = `ç›¸ä½: ${cloud.patternPhase.toFixed(2)}`;
        }
        
        // æ›´æ–°äº‘æœµå‚æ•°
        function updateCloudParameters() {
            if (selectedCloudIndex === -1) return;
            
            const cloud = clouds.find(c => c.id === selectedCloudIndex);
            if (!cloud) return;
            
            cloud.patternSpeed = parseFloat(document.getElementById('cloudSpeed').value);
            cloud.amplitude = parseFloat(document.getElementById('cloudAmplitude').value);
            cloud.deformation = parseFloat(document.getElementById('cloudDeformation').value);
            cloud.rotationSpeed = parseFloat(document.getElementById('cloudRotation').value);
            cloud.pattern = parseInt(document.getElementById('cloudPattern').value);
            
            // å¦‚æœæ”¹å˜äº†æ¨¡å¼ï¼Œæ›´æ–°ç›¸å…³å‚æ•°
            if (cloud.pattern !== 2) {
                cloud.rotationSpeed = 0;
                document.getElementById('cloudRotation').value = 0;
                document.getElementById('cloudRotationValue').textContent = '0.00';
            }
            
            updateCloudList();
            updateSelectedCloudControls();
        }
        
        // æ·»åŠ æ–°äº‘æœµ
        function addCloud() {
            const newId = clouds.length > 0 ? Math.max(...clouds.map(c => c.id)) + 1 : 0;
            const pattern = Math.floor(Math.random() * 3);
            
            const newCloud = {
                id: newId,
                x: GAME_WIDTH,
                y: Math.random() * (GAME_HEIGHT * 0.7),
                width: 80 + Math.random() * 60,
                height: 40 + Math.random() * 20,
                speed: 20 + Math.random() * 30,
                opacity: 0.3 + Math.random() * 0.4,
                layer: 0,
                pattern: pattern,
                amplitude: 5 + Math.random() * 15,
                patternSpeed: 0.5 + Math.random() * 2,
                patternPhase: Math.random() * Math.PI * 2,
                rotationSpeed: pattern === 2 ? (Math.random() - 0.5) * 0.2 : 0,
                rotationAngle: 0,
                originalHeight: 40 + Math.random() * 20,
                deformation: Math.random() * 0.1 + 0.05,
                color: pattern === 0 ? '#ffffff' : pattern === 1 ? '#f0f8ff' : '#e6f7ff'
            };
            
            clouds.push(newCloud);
            updateCloudList();
            updateInfo();
            
            // è‡ªåŠ¨é€‰æ‹©æ–°æ·»åŠ çš„äº‘æœµ
            selectCloud(clouds.length - 1);
        }
        
        // ç§»é™¤äº‘æœµ
        function removeCloud() {
            if (selectedCloudIndex === -1 || clouds.length <= 1) return;
            
            clouds = clouds.filter(c => c.id !== selectedCloudIndex);
            selectedCloudIndex = clouds.length > 0 ? clouds[0].id : -1;
            
            updateCloudList();
            updateInfo();
            
            if (selectedCloudIndex !== -1) {
                updateSelectedCloudControls();
            } else {
                hideSelectedCloudControls();
            }
        }
        
        // æ›´æ–°ä¿¡æ¯æ˜¾ç¤º
        function updateInfo() {
            document.getElementById('cloudCount').textContent = clouds.length;
            document.getElementById('gameTime').textContent = gameTime.toFixed(1);
        }
        
        // æ¸²æŸ“æ¸¸æˆ
        function renderGame() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // ç»˜åˆ¶èƒŒæ™¯
            drawBackground();
            
            // ç»˜åˆ¶è¯´æ˜æ–‡å­—
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = '16px Arial';
            ctx.fillText('äº‘æœµé£˜åŠ¨æ•ˆæœæµ‹è¯• - æ‹–åŠ¨æ»‘å—è°ƒæ•´å‚æ•°', 20, 30);
            ctx.fillText('é€‰ä¸­äº‘æœµå¯ä»¥ç¼–è¾‘å•ä¸ªäº‘æœµçš„å‚æ•°', 20, 50);
        }
        
        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            const currentTime = performance.now();
            const deltaTime = (currentTime - lastUpdateTime) / 1000; // è½¬æ¢ä¸ºç§’
            lastUpdateTime = currentTime;
            
            // æ›´æ–°FPS
            frameCount++;
            if (currentTime - lastFpsUpdate >= 1000) {
                currentFps = Math.round(frameCount * 1000 / (currentTime - lastFpsUpdate));
                frameCount = 0;
                lastFpsUpdate = currentTime;
                document.getElementById('fps').textContent = currentFps;
            }
            
            // æ›´æ–°æ¸¸æˆæ—¶é—´
            gameTime += deltaTime;
            
            // æ›´æ–°åŠ¨æ€èƒŒæ™¯
            updateBackground(deltaTime);
            
            // æ¸²æŸ“æ¸¸æˆ
            renderGame();
            
            // ç»§ç»­æ¸¸æˆå¾ªç¯
            requestAnimationFrame(gameLoop);
        }
        
        // åˆå§‹åŒ–æ§åˆ¶äº‹ä»¶
        function initControls() {
            // æ—¶é—´æµé€Ÿæ§åˆ¶
            const timeSpeedSlider = document.getElementById('timeSpeed');
            const timeSpeedValue = document.getElementById('timeSpeedValue');
            timeSpeedSlider.addEventListener('input', function() {
                timeSpeedMultiplier = parseFloat(this.value);
                timeSpeedValue.textContent = timeSpeedMultiplier.toFixed(1);
            });
            
            // å…¨å±€é€Ÿåº¦æ§åˆ¶
            const globalSpeedSlider = document.getElementById('globalSpeed');
            const globalSpeedValue = document.getElementById('globalSpeedValue');
            globalSpeedSlider.addEventListener('input', function() {
                globalSpeedMultiplier = parseFloat(this.value);
                globalSpeedValue.textContent = globalSpeedMultiplier.toFixed(1);
            });
            
            // å…¨å±€å¹…åº¦æ§åˆ¶
            const globalAmplitudeSlider = document.getElementById('globalAmplitude');
            const globalAmplitudeValue = document.getElementById('globalAmplitudeValue');
            globalAmplitudeSlider.addEventListener('input', function() {
                globalAmplitudeMultiplier = parseFloat(this.value);
                globalAmplitudeValue.textContent = globalAmplitudeMultiplier.toFixed(1);
            });
            
            // äº‘æœµå‚æ•°æ§åˆ¶
            document.getElementById('cloudSpeed').addEventListener('input', function() {
                document.getElementById('cloudSpeedValue').textContent = parseFloat(this.value).toFixed(1);
                updateCloudParameters();
            });
            
            document.getElementById('cloudAmplitude').addEventListener('input', function() {
                document.getElementById('cloudAmplitudeValue').textContent = parseFloat(this.value).toFixed(0);
                updateCloudParameters();
            });
            
            document.getElementById('cloudDeformation').addEventListener('input', function() {
                document.getElementById('cloudDeformationValue').textContent = parseFloat(this.value).toFixed(2);
                updateCloudParameters();
            });
            
            document.getElementById('cloudRotation').addEventListener('input', function() {
                document.getElementById('cloudRotationValue').textContent = parseFloat(this.value).toFixed(2);
                updateCloudParameters();
            });
            
            document.getElementById('cloudPattern').addEventListener('change', updateCloudParameters);
            
            // æŒ‰é’®æ§åˆ¶
            document.getElementById('resetBtn').addEventListener('click', function() {
                initBackground();
                selectedCloudIndex = -1;
                hideSelectedCloudControls();
            });
            
            document.getElementById('addCloudBtn').addEventListener('click', addCloud);
            document.getElementById('removeCloudBtn').addEventListener('click', removeCloud);
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function init() {
            initBackground();
            initControls();
            lastUpdateTime = performance.now();
            lastFpsUpdate = lastUpdateTime;
            gameLoop();
        }
        
        // å¯åŠ¨æ¸¸æˆ
        init();
    </script>
</body>
</html>